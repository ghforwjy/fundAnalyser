## 正确流程设计

### 流程图
```
点击"启动数据采集" 
    ↓
弹出【日期选择对话框】
    ↓
选择同步方式 + 日期范围
    ↓
点击【开始同步】
    ↓
关闭日期选择对话框
    ↓
弹出【同步进度对话框】
    ↓
显示进度 + 可停止
```

### 1. 日期选择对话框（新）

```tsx
{/* 日期选择对话框 */}
<Dialog open={isDateSelectOpen} onOpenChange={setIsDateSelectOpen}>
  <DialogContent className="sm:max-w-[500px]">
    <DialogHeader>
      <DialogTitle>选择同步日期范围</DialogTitle>
      <DialogDescription>
        选择要同步的数据日期范围
      </DialogDescription>
    </DialogHeader>

    <div className="space-y-6 py-4">
      {/* 同步方式选择 */}
      <div className="space-y-3">
        <Label className="text-base">同步方式</Label>
        <RadioGroup 
          value={syncMode} 
          onValueChange={(value) => setSyncMode(value as 'auto' | 'manual')}
          className="flex flex-col gap-3"
        >
          <div className="flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-muted">
            <RadioGroupItem value="auto" id="auto" className="mt-1" />
            <div className="flex-1">
              <Label htmlFor="auto" className="font-medium cursor-pointer">
                自动增量同步（推荐）
              </Label>
              <p className="text-sm text-muted-foreground mt-1">
                自动从数据库最新日期的下一天同步到今天
              </p>
              {autoDateRange && (
                <p className="text-sm text-cyan-600 mt-2">
                  预计同步：{autoDateRange.start} 至 {autoDateRange.end}
                </p>
              )}
            </div>
          </div>
          
          <div className="flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-muted">
            <RadioGroupItem value="manual" id="manual" className="mt-1" />
            <div className="flex-1">
              <Label htmlFor="manual" className="font-medium cursor-pointer">
                指定日期范围
              </Label>
              <p className="text-sm text-muted-foreground mt-1">
                手动选择要同步的起始和结束日期
              </p>
            </div>
          </div>
        </RadioGroup>
      </div>

      {/* 手动日期选择 */}
      {syncMode === 'manual' && (
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label>开始日期</Label>
            <Input
              type="date"
              value={manualDateRange.start}
              max={manualDateRange.end || undefined}
              onChange={(e) => setManualDateRange(prev => ({
                ...prev, 
                start: e.target.value
              }))}
            />
          </div>
          <div className="space-y-2">
            <Label>结束日期</Label>
            <Input
              type="date"
              value={manualDateRange.end}
              min={manualDateRange.start || undefined}
              max={new Date().toISOString().split('T')[0]}
              onChange={(e) => setManualDateRange(prev => ({
                ...prev, 
                end: e.target.value
              }))}
            />
          </div>
        </div>
      )}
    </div>

    <DialogFooter>
      <Button variant="outline" onClick={() => setIsDateSelectOpen(false)}>
        取消
      </Button>
      <Button 
        onClick={handleConfirmSync}
        disabled={syncMode === 'manual' && (!manualDateRange.start || !manualDateRange.end)}
        className="bg-cyan-500 hover:bg-cyan-600"
      >
        <Play className="w-4 h-4 mr-2" />
        开始同步
      </Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

### 2. 修改按钮点击逻辑

```tsx
// 点击"启动数据采集"按钮
const handleSyncClick = async (source: DataSource) => {
  if (!source.is_active) {
    toast.error('请先启用数据源');
    return;
  }
  
  // 先计算自动日期范围
  await calculateAutoDateRange();
  
  // 打开日期选择对话框
  setIsDateSelectOpen(true);
};

// 确认开始同步
const handleConfirmSync = () => {
  setIsDateSelectOpen(false);
  
  const dateRange = syncMode === 'auto' ? autoDateRange : manualDateRange;
  
  // 打开进度对话框并开始同步
  setSyncProgress({
    show: true,
    stage: '准备同步',
    current: 0,
    total: 0,
    message: `同步日期范围: ${dateRange.start} 至 ${dateRange.end}`,
    errors: []
  });
  
  // 开始同步...
  startSync(dateRange);
};
```

### 3. 需要添加的组件
- RadioGroup（shadcn/ui）
- 可能需要添加

### 4. 状态管理
```tsx
const [isDateSelectOpen, setIsDateSelectOpen] = useState(false);
const [syncMode, setSyncMode] = useState<'auto' | 'manual'>('auto');
const [autoDateRange, setAutoDateRange] = useState<{start: string, end: string} | null>(null);
const [manualDateRange, setManualDateRange] = useState({start: '', end: ''});
```

## 实施步骤
1. 添加 RadioGroup 组件到项目
2. 在 DataSource.tsx 添加日期选择对话框
3. 修改 handleSyncData 为打开日期选择对话框
4. 添加自动计算日期范围函数
5. 修改同步API调用，传入日期参数

请确认后实施。