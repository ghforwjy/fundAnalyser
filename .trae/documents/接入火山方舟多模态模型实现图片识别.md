## 方案概述
接入火山方舟大模型服务平台的多模态模型，实现从基金持仓截图中自动识别基金信息。

## 实施步骤

### 1. 环境配置
- 在 `backend/.env` 文件中添加火山方舟模型配置：
  - `ARK_API_KEY` - API密钥
  - `ARK_BASE_URL` - 基础URL（默认：https://ark.cn-beijing.volces.com/api/v3）
  - `ARK_VISION_MODEL` - 多模态模型ID（如：doubao-vision-xxx）

### 2. 后端实现

#### 2.1 安装依赖
```bash
pip install volcengine-python-sdk[ark]
```

#### 2.2 创建图片识别服务
新建 `backend/services/image_recognition_service.py`：
- 封装火山方舟多模态模型调用
- 实现 `recognize_fund_image(image_base64)` 函数
- 返回结构化的基金信息（基金代码、名称、份额、净值）

#### 2.3 添加API接口
在 `backend/api/portfolio.py` 中添加：
- `POST /api/portfolio/recognize-image` - 接收图片，返回识别的基金列表
- 支持 base64 图片数据上传
- 返回格式与现有前端兼容

### 3. 前端修改

#### 3.1 更新API服务
在 `app/src/services/api.ts` 中添加：
- `portfolioApi.recognizeImage(imageBase64)` 方法

#### 3.2 修改导入对话框
在 `app/src/pages/Portfolio/index.tsx` 中：
- 替换模拟OCR为真实API调用
- 保持现有UI交互逻辑不变

## 技术细节

### 火山方舟多模态模型调用示例
```python
from volcenginesdkarkruntime import Ark

client = Ark(
    base_url='https://ark.cn-beijing.volces.com/api/v3',
    api_key=os.getenv('ARK_API_KEY'),
)

response = client.chat.completions.create(
    model=os.getenv('ARK_VISION_MODEL'),
    messages=[
        {
            "role": "user",
            "content": [
                {"type": "text", "text": "识别这张基金持仓截图，提取基金代码、基金名称、持有份额、参考净值。返回JSON格式。"},
                {"type": "image_url", "image_url": {"url": f"data:image/jpeg;base64,{image_base64}"}}
            ]
        }
    ]
)
```

### 返回数据格式
```json
{
  "success": true,
  "data": [
    {
      "fundCode": "000330",
      "fundName": "汇添富现金宝货币A",
      "shares": 19098.83,
      "nav": 1.0000,
      "amount": 19098.83
    }
  ]
}
```

## 文件变更清单
1. `backend/.env` - 添加环境变量
2. `backend/config.py` - 添加模型配置
3. `backend/services/image_recognition_service.py` - 新建图片识别服务
4. `backend/api/portfolio.py` - 添加识别接口
5. `backend/requirements.txt` - 添加依赖
6. `app/src/services/api.ts` - 添加前端API
7. `app/src/pages/Portfolio/index.tsx` - 替换模拟数据为真实调用

请确认后，我将开始实施具体的代码修改。